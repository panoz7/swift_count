<html>

<head>

<script type='module'>

    import {makeHttpRequest} from './modules/helper.js';

    window.onload = setup;

    function setup() {

        let tbody = document.getElementById('logs');

        makeHttpRequest('api/logs','GET')
            .then((res) => {
                res = JSON.parse(res);

                console.log(res);
                
                res.forEach(log => {
                    let date = new Date(log.date);

                    let dateLink = document.createElement('a');
                    dateLink.href = `log.html?id=${log.id}`;
                    dateLink.innerHTML = `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
                    
                    let totalCount = log.totalCount ? log.totalCount : 0;

                    let logDisplayNames = {
                        realTime: "Real Time",
                        video: "Video"
                    } 
                    let logName = logDisplayNames[log.log_type] ? logDisplayNames[log.log_type] : "Other";

                    tbody.appendChild(buildRow([log.id, dateLink, logName, totalCount, log.weather, log.notes]))
                })
            })


    }

    function buildRow(cols, cellType = 'td') {

        let tr = document.createElement('tr');

        cols.forEach(value => {
            let cell = document.createElement(cellType);

            if (typeof value == 'object') cell.appendChild(value);
            else cell.innerHTML = value;

            tr.appendChild(cell);
        })

        return tr;
    }

</script>

<style>

    body {
        font-family: arial;
    }

    table {
        border-collapse: collapse;
    }

    td, th{
        padding: 5px 10px;
        border: 1px solid black;
    }

</style>


</head>

<body>

<h2>Swift Count</h2>
<ul>
    <li>
        <a href='videolog.html'>Create new log from video</a>
    </li>
</ul>

<table>
<thead>
<tr>
<th>ID</th>
<th>Date</th>
<th>Type</th>
<th>Count</th>
<th>Weater</th>
<th>Notes</th>
</tr>
</head>
<tbody id='logs'>
</tbody>
</table>